<HTML><HEAD>   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">   <META NAME="Author" CONTENT="Trent Lillehaugen">   <META NAME="GENERATOR" CONTENT="Mozilla/4.01 [en] (Win95; I) [Netscape]">   <TITLE>ASM 86 LESSON 3</TITLE></HEAD><BODY BACKGROUND="gfx/zand.jpg"><CENTER><B><FONT FACE="Times New Roman,Times"><FONT SIZE=+3>L</FONT><FONT SIZE=+2>ESSON</FONT><FONT SIZE=+3>3</FONT><FONT SIZE=+2>:</FONT></FONT></B></CENTER><CENTER><HR WIDTH="100%"></CENTER><FONT SIZE=+1>&nbsp;</FONT>&nbsp;&nbsp; <FONT SIZE=+1>Loops are one ofthe basic building blocks in programming, there are many uses for loops,and many ways to implement them.</FONT><CENTER>&nbsp;<IMG SRC="waveline.gif" HEIGHT=16 WIDTH=756></CENTER><CENTER><A NAME="LIST"></A><B><I><FONT COLOR="#000000"><FONT SIZE=+2>Theseare the instructions/ideas that will be covered in this lesson:</FONT></FONT></I></B></CENTER><CENTER><FONT COLOR="#990000"><FONT SIZE=+2><A HREF="lesson3.htm#LABELS">LABELS</A></FONT></FONT></CENTER><CENTER><FONT COLOR="#990000"><FONT SIZE=+2><A HREF="lesson3.htm#JR">JR</A></FONT></FONT></CENTER><CENTER><FONT COLOR="#990000"><FONT SIZE=+2><A HREF="lesson3.htm#JP">JP</A></FONT></FONT></CENTER><CENTER><FONT COLOR="#990000"><FONT SIZE=+2><A HREF="lesson3.htm#DIFF">DIFFERENCESBETWEEN JR AND JP</A></FONT></FONT></CENTER><CENTER><FONT COLOR="#990000"><FONT SIZE=+2><A HREF="lesson3.htm#DJNZ">DJNZ</A></FONT></FONT></CENTER>&nbsp;<CENTER><IMG SRC="waveline.gif" HEIGHT=16 WIDTH=756></CENTER><A NAME="LABELS"></A><FONT SIZE=+4>LABELS</FONT><BR><FONT SIZE=+1><FONT FACE="Times New Roman,Times">&nbsp; Labels area way to define a certain area in the program.&nbsp; To define labels,you must first enter the name of the label then a ":".&nbsp; </FONT>Hereare some examples:</FONT><BLOCKQUOTE><TT><FONT SIZE=+1><B>loop:</B>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; this is a label</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; ld a,5</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; push af&nbsp;&nbsp;&nbsp;&nbsp; ;just somestuff</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; push bc</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; inc a</FONT></TT><BR><TT><FONT SIZE=+1><B>anotherlabel:</B> ; this is another label</FONT></TT></BLOCKQUOTE><FONT SIZE=+1><FONT COLOR="#660000">&nbsp;&nbsp; NOTE</FONT>: Labels cannotbe indented!</FONT><P><A HREF="lesson3.htm#LIST">back to list of instructions</A><P><IMG SRC="waveline.gif" HEIGHT=16 WIDTH=756><BR><A NAME="JR"></A><FONT SIZE=+4>JR</FONT><BR><FONT SIZE=+1>&nbsp; The ASM code is always processed sequently, oneinstruction after the next.&nbsp; However, if you want to skip to a certainpart of the code, or go back and repeat a previous portion you must jumpthere.&nbsp; There are 2 different ways to JUMP to another part of code.&nbsp;JR, and JP.&nbsp; There are a few differences that are discussed <A HREF="lesson3.htm#DIFF">later</A>,but they are VERY IMPORTANT!</FONT><BR><FONT SIZE=+1>&nbsp; To jump to a certain part of code you must enterJR <I>LABELNAME</I>.&nbsp; Here are some examples:</FONT><BLOCKQUOTE><TT><FONT SIZE=+1>&nbsp; ld a,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;a=1</FONT></TT><BR><TT><FONT SIZE=+1>MyLabel:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;LABEL</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; inc a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;a=a+1</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; jr MyLabel&nbsp; ;jump to LABEL</FONT></TT><BR>&nbsp;</BLOCKQUOTE><FONT SIZE=+1><FONT COLOR="#660000">&nbsp; NOTE</FONT>: This code willcause an infinite loop.&nbsp; The code between 'MyLabel' and 'jr MyLabel'will be repeated over and over.</FONT><P><FONT SIZE=+1>&nbsp; In order to make jumps ONLY IF certain requirmentsare met, we use the following conditionals:</FONT><UL><LI><FONT SIZE=+1>C&nbsp;&nbsp;&nbsp;&nbsp; (Carry)</FONT></LI><LI><FONT SIZE=+1>NC&nbsp;&nbsp; (No Carry)</FONT></LI><LI><FONT SIZE=+1>Z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Zero)</FONT></LI><LI><FONT SIZE=+1>NZ&nbsp;&nbsp; (Not Zero)</FONT></LI></UL><FONT SIZE=+1>&nbsp; These conditions are based on how the F register isset.&nbsp; Remeber it is the FLAG register. Here are some examples:</FONT><BLOCKQUOTE><TT><FONT SIZE=+1>&nbsp; ld a,5&nbsp;&nbsp;&nbsp;&nbsp; ;a=5</FONT></TT><BR><TT><FONT SIZE=+1>Loop:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;MyLOOP Label</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; dec a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;a=a-1</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; jr nz,Loop ;if A is not zero then jump toLoop.</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;(When the value of <B>A</B> changes <B>F</B> is ALWAYS updated)</FONT></TT></BLOCKQUOTE><FONT SIZE=+1>&nbsp; This loop will execute 5 times, it doesn't do anythingyet, but in a few lessons, we'll get it to do somthing cool, don't worry:)</FONT><P><A HREF="lesson3.htm#LIST">back to list of instructions</A><BR><IMG SRC="waveline.gif" HEIGHT=16 WIDTH=756><BR><A NAME="JP"></A><FONT SIZE=+4>JP</FONT><BR><FONT SIZE=+1>&nbsp; The ASM code is always processed sequently, oneinstruction after the next.&nbsp; However, if you want to skip to a certainpart of the code, or back to a previous portion you must jump there.&nbsp;There are 2 different ways to JUMP to another part of code.&nbsp; JR, andJP.&nbsp; There are a few differences that are discussed later, but theyare VERY IMPORTANT!</FONT><BR><FONT SIZE=+1>&nbsp; To jump to a certain part of code you must enterJP <I>LABELNAME</I>.&nbsp; Here are some examples:</FONT><BLOCKQUOTE><TT><FONT SIZE=+1>&nbsp; ld a,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;a=1</FONT></TT><BR><TT><FONT SIZE=+1>MyLabel:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;LABEL</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; inc a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;a=a+1</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; jp MyLabel&nbsp; ;jump to LABEL</FONT></TT><BR>&nbsp;</BLOCKQUOTE><FONT SIZE=+1><FONT COLOR="#660000">&nbsp; NOTE</FONT>: This code willcause an infinite loop.&nbsp; The code between 'MyLabel' and 'jr MyLabel'will be repeated over and over.</FONT><P><FONT SIZE=+1>&nbsp; In order to make jumps ONLY IF certain requirmentsare met, we use the following conditionals:</FONT><UL><LI><FONT SIZE=+1>C&nbsp;&nbsp;&nbsp;&nbsp; (<B><I>C</I></B>arry)</FONT></LI><LI><FONT SIZE=+1>NC&nbsp;&nbsp; (<B><I>N</I></B>o <B><I>C</I></B>arry)</FONT></LI><LI><FONT SIZE=+1>Z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<B><I>Z</I></B>ero)</FONT></LI><LI><FONT SIZE=+1>NZ&nbsp;&nbsp; (<B><I>N</I></B>ot <B><I>Z</I></B>ero)</FONT></LI><LI><FONT SIZE=+1>M&nbsp;&nbsp;&nbsp;&nbsp; (<B><I>M</I></B>inus)</FONT></LI><LI><FONT SIZE=+1>P&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<B><I>P</I></B>ositive)</FONT></LI><LI><FONT SIZE=+1>PE&nbsp;&nbsp;&nbsp; (<B><I>P</I></B>arity <B><I>E</I></B>ven)</FONT></LI><LI><FONT SIZE=+1>PO&nbsp;&nbsp;&nbsp; (<B><I>P</I></B>arity <B><I>O</I></B>dd)</FONT></LI></UL><FONT SIZE=+1>&nbsp; You can already see some differences between JR andJP.&nbsp; JP alows the use of 4 more conditions! These conditions are basedon how the F register is set.&nbsp; Remeber it is the FLAG register. Hereare some examples:</FONT><BLOCKQUOTE><TT><FONT SIZE=+1>&nbsp; ld a,5&nbsp;&nbsp;&nbsp;&nbsp; ;a=5</FONT></TT><BR><TT><FONT SIZE=+1>Loop:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;MyLOOP Label</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; dec a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;a=a-1</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; jp p,Loop&nbsp; ;if A is positive then jumpto Loop.</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;(When the value of <B>A</B> changes <B>F</B> is ALWAYS updated)</FONT></TT></BLOCKQUOTE><FONT SIZE=+1>&nbsp; This loop will execute 6 times (a=5,4,3,2,1,0), itdoesn't do anything yet, but in a few lessons, we'll get it to do somthingcool, don't worry :)</FONT><P><A HREF="lesson3.htm#LIST">back to list of instructions</A><P><IMG SRC="waveline.gif" HEIGHT=16 WIDTH=756><BR><A NAME="DIFF"></A><FONT SIZE=+4>DIFFERENCES BETWEEN JR/JP</FONT><BR><FONT SIZE=+1>&nbsp; The Main difference bettween the 2 types of jumps(jr, jp) is the JR is a <B><I>RELETIVE</I></B> jump.&nbsp; When translatedinto machine code it essential says 'jump this many bytes forward/backward',for this reason, it has a limited range.&nbsp; If you plan on jumping furtherthen the range allowed by JR you&nbsp; <U>MUST</U> use JP.&nbsp; JP isan ABSOLUTE jump.&nbsp; When translated into machine code it basicallysays 'jump to this location'.&nbsp; The advantage of JR over JP is bothsize and speed in the final compiled program.</FONT><BR><FONT SIZE=+1>&nbsp; Another difference, which we have already seenis that JP allows you to use more conditions.&nbsp; JR does not supportP,M,PO, or PE.&nbsp; I have not covered all these conditions, but I willin Future lessons/examples.</FONT><P><A HREF="lesson3.htm#LIST">back to list of instructions</A><P><IMG SRC="waveline.gif" HEIGHT=16 WIDTH=756><BR><A NAME="DJNZ"></A><FONT SIZE=+4>DJNZ</FONT><BR><FONT SIZE=+1>&nbsp; DJNZ is a very helpful instruction.&nbsp; It combinesthe [DEC -> JP nz,label] sequence used so often in loops.</FONT><BLOCKQUOTE><TT><FONT SIZE=+1>&nbsp; ld b,15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;b=15, the number of times for the loop to execute</FONT></TT><BR><TT><FONT SIZE=+1>Loop:</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; ; all the cool loop stuff inside of here</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; djnz Loop&nbsp;&nbsp;&nbsp; ;b=b-1, jump is<B>b</B> is <B>N</B>ot<B>Z</B>ero</FONT></TT></BLOCKQUOTE><FONT SIZE=+1><FONT COLOR="#660000">&nbsp;NOTE</FONT>: DJNZ always usesthe register <B><I>B</I></B>.&nbsp; It decrements B,&nbsp; checks if Bis nz, if so then jumps to the label.</FONT><BR><FONT SIZE=+1><FONT COLOR="#660000">&nbsp;NOTE</FONT>: If the valueof B is changed inside your loop code remeber to use PUSH/POP so your valueis not destroyed.</FONT><BLOCKQUOTE><TT><FONT SIZE=+1>&nbsp; ld a,0</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; ld b,15</FONT></TT><BR><TT><FONT SIZE=+1>Loop:</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; push bc&nbsp; ;<B>adds it to the stack</B></FONT></TT><BR><TT><FONT SIZE=+1><B>&nbsp; </B>ld b,4&nbsp;&nbsp; ;b=4</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; add a,b&nbsp; ;a=a+b, a=a+4</FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; pop bc&nbsp;&nbsp; ;<B>gets our value of Bback!</B></FONT></TT><BR><TT><FONT SIZE=+1>&nbsp; djnz Loop</FONT></TT></BLOCKQUOTE><A HREF="lesson3.htm#LIST">back to list of instructions</A><BR><IMG SRC="waveline.gif" HEIGHT=16 WIDTH=756><CENTER><FONT SIZE=+1><A HREF="lesson2.htm">LESSON2</A></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT SIZE=+1><A HREF="z80_home.htm">INDEX</A>&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="lesson4.htm">LESSON4</A></FONT></CENTER><CENTER>This is the end of the lesson, I do not gaurantee any correctnessof any statements made above.</CENTER></BODY></HTML>