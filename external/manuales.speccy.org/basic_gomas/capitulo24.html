<html>
<head>
<title>Manual Basic Spectrum 48k - Capítulo 24</title>
<meta name="author" content="Miguel">
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<style type="text/css">
<!--
	p { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; color: #0000; text-indent: 1em; text-align: justify;}
	.inverse { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; color:#ffffff;background-color:black;}
	.texto { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; color: #000000}
	.codigo { font-family: Courier, monotype; font-size: 12px; font-style: normal; font-variant: normal; color:black; background-color:blue:}
//-->
</style>
</head>
<body text="#000000" bgcolor="#d9dddd" link="#000099" vlink="#990099" alink="#000099" font="" face="Verdana,Helvetica,Arial,Times">
<a name="inicio">
<html>
<head>
  <meta http-equiv="content-type"
 content="text/html; charset=ISO-8859-1">
  <meta name="author" content="Miguel">
  <script language="JavaScript">
<!--
function enlace(url)
{
document.location = url.options[url.selectedIndex].value;
}
-->
  </script>
</head>
<body>
<table cellpadding="2" bgcolor="d9dddd" cellspacing="0" border="0" width="700"
 align="center">
  <tbody>
    <tr>
      <td valign="middle" rowspan="1" colspan="1">
      <form>
        <select onchange="enlace(this)" name="select" target="main"
 title="Selecciona capítulo" align="center">
        <option value="" selected="selected">-Selecciona capítulo-</option>
        <option value="index.html">Indice</option>
        <option value="capitulo01.html">Capítulo 1</option>
        <option value="capitulo02.html">Capítulo 2</option>
	<option value="capitulo03.html">Capítulo 3</option>
	<option value="capitulo04.html">Capítulo 4</option>
	<option value="capitulo05.html">Capítulo 5</option>
	<option value="capitulo06.html">Capítulo 6</option>
	<option value="capitulo07.html">Capítulo 7</option>
	<option value="capitulo08.html">Capítulo 8</option>
	<option value="capitulo09.html">Capítulo 9</option>
	<option value="capitulo10.html">Capítulo 10</option>
	<option value="capitulo11.html">Capítulo 11</option>
	<option value="capitulo12.html">Capítulo 12</option>
        <option value="capitulo13.html">Capítulo 13</option>
	<option value="capitulo14.html">Capítulo 14</option>
	<option value="capitulo15.html">Capítulo 15</option>
	<option value="capitulo16.html">Capítulo 16</option>
	<option value="capitulo17.html">Capítulo 17</option>
	<option value="capitulo18.html">Capítulo 18</option>
	<option value="capitulo19.html">Capítulo 19</option>
	<option value="capitulo20.html">Capítulo 20</option>
	<option value="capitulo21.html">Capítulo 21</option>
	<option value="capitulo22.html">Capítulo 22</option>
	<option value="capitulo23.html">Capítulo 23</option>
	<option value="capitulo24.html">Capítulo 24</option>
	<option value="capitulo25.html">Capítulo 25</option>
	<option value="capitulo26.html">Capítulo 26</option>
	</select>
      </form>
      </td>
      <td valign="middle" width="74%" align="right">
      <h4><font color="#000000">Manual de Basic Spectrum 48k.</font></h4>
      </td>
    </tr>
  </tbody>
</table>
</body>
</html>
<table cellpadding="4" cellspacing="0" border="0" width="700" align="center" bgcolor="#ffffff">
<tr>
<td>
<span class="texto">
<div align="right"><b>Capítulo 24</b></div>

<h2>La memoria</h2>

<h4>Resumen</h4>

<ul>
<li><b>CLEAR</b></li>
</ul>

<p>En las profundidades del ordenador, todo se almacena en octetos (bytes), como, por ejemplo, los números entre 0 y 255. Se puede creer que se ha almacenado el precio de la lana o la dirección del vendedor de fertilizantes, pero todo ha sido convertido a conjuntos de octetos y lo único que el ordenador ve son octetos.</p>

<p>Todo lugar donde se puede almacenar un octeto posee una dirección, que es un número comprendido entre 0 y FFFFh (de modo que cualquier dirección puede almacenarse como un par de octetos), de modo que se puede considerar la memoria como si fuera una larga fila de casillas numeradas, cada una de las cuales puede contener su octeto (byte). Sin embargo, no todas las casillas son iguales, pues en la máquina estándar de 16K RAM las casillas numeradas del 8000h al FFFFh (1) faltan al completo. Las casillas del 4000h al 7FFFh son casillas de RAM, lo que quiere decir que se puede levantar la tapa y cambiarle el contenido. Finalmente, aquellas numeradas del 0 al 3FFFh son casillas ROM, que están "recubiertas" de cristal y que no pueden abrirse. Todo lo que se puede hacer es leer lo que se depositó allí cuando se fabricó el ordenador.</p>

<div align="center"><img src="images/pag163.png" border="0"></div>

<p>Para inspeccionar el contenido de una casilla, empleamos la función <b>PEEK</b>: su argumento es la dirección de la casilla y su resultado el contenido. Por ejemplo, el programa siguiente imprime los primeros 21 octetos de la ROM (y sus direcciones):</p>

<table align="center" border="0" valign="top">
<tr>
<td align="left">
<span class="codigo">
10 PRINT "Direcciones"; TAB 8; "Octeto"<br>
20 FOR a = 0 TO 20<br>
30 PRINT a; TAB 8; PEEK a<br>
40 NEXT a
</span>
</td>
</tr>
</table>

<p>Es probable que todos estos octetos carezcan de significado para el lector, pero la pastilla procesadora los entiende como instrucciones que le indican qué hacer.</p>

<p>Para variar el contenido de una casilla (si es de RAM), empleamos la sentencia <b>POKE</b> (introducir), cuya forma es</p>

<div align="center"><span class="codigo"><b>POKE</b> dirección, nuevo contenido</span></div>

<p>en donde la "dirección" y el "nuevo contenido" representan expresiones numéricas. Por ejemplo, si se dice</p>

<div align="center"><span class="codigo">POKE 31000, 57</span></div>

<p>al octeto de la dirección 31000 se le da el nuevo valor 57. Escríbase</p>

<div align="center"><span class="codigo">PRINT PEEK 31000</span></div>

<p>para probarlo. (Trate de ejercer la función <b>POKE</b> con otros valores para comprobar que no hay trampa). Los nuevos valores han de estar comprendidos entre -255 y +255 y si el elegido es negativo, entonces, se le añade 256.</p>

<p>La función <b>POKE</b> otorga un poder "inmenso" sobre el ordenador siempre que se la sepa emplear y posibilidades destructoras enormes si no se sabe. Es muy fácil echar a perder un programa que costó horas de teclado, mediante el ejercicio de <b>POKE</b> con un valor incorrecto en una dirección equivocada. Afortunadamente, ello no producirá al ordenador ningún daño permanente.</p>

<p>Echaremos, ahora, un vistazo más detallado a la manera en que se usa la RAM, pero no se moleste en leerlo si no le interesa el tema.</p>

<p>La memoria está dividida en zonas diferentes (que se muestran en el diagrama grande) para almacenar distintos tipos de información. Estas zonas son sólo suficientemente grandes para contener la información que contienen realmente, por lo que si se añade algo más en algún punto determinado (por ejemplo, incluyendo una línea de programa o una variable) se hace sitio empujando hacia arriba todo lo que queda por encima de este punto. Y al contrario si se borra información, entonces todo se empuja hacia abajo.</p>

<p>El archivo para la representación en pantalla almacena una imagen de televisión. Resulta bastante curioso el modo en que está presentado, por lo que es probable que se prefiera no ejercer en ella las funciones <b>PEEK</b> y <b>POKE</b>. Cada carácter de la pantalla posee un cuadrado de 8x8 puntos y cada punto puede tomar el valor 0 (papel) ó 1 (tinta): así, utilizando la notación binaria se puede almacenar la configuración como 8 octetos, uno para cada fila. Sin embargo, estos 8 octetos no se almacenan juntos, sino que lo hacen las filas correspondientes de los 32 caracteres de una línea sencilla, como una traza de 32 octetos, ya que esto es lo que necesita el haz electrónico de la televisión a medida que barre la pantalla de izquierda a derecha. Como quiera que la imagen completa tiene 24 líneas de 8 barridos cada una, podría esperarse que hubiera que almacenar 172 barridos en total correlativos, pero no es verdad. Primero vienen las trazas superiores de las líneas 0 y 7, después, el siguiente barrido de las mismas líneas de 0 a 7 y así hasta llegar a la línea inferior de las citadas líneas de 0 a 7. A continuación, se repite el mismo proceso para las líneas de 8 a 15 y, tras ello, se hace lo mismo con las líneas de 16 a 23. El resultado final de todo esto es que si estamos habituados a un ordenador que usa las funciones <b>PEEK</b> y <b>POKE</b> en la pantalla, habrá que cambiarse a usar <b>SCREEN$</b> y <b>PRINT AT</b> en su lugar, o <b>PLOT</b> y <b>POINT</b>.</p>

<p>Los atributos son los colores, etc., para cada posición de carácter, mediante el uso de <b>ATTR</b>. Todo ello se almacena línea tras línea en el orden que se espera.</p>

<p>La memoria temporal de la impresora almacena los caracteres destinados a impresión.</p>

<p>Las variables del sistema contienen varios elementos de información que indican al ordenador en qué estado se halla. Como están completamente listadas en el capítulo próximo, nos conformaremos por el momento con destacar que existen algunas (llamadas <b>CHANS</b>, <b>PROG</b>, <b>VARS</b>, <b>E_LINE</b>, etc.) que contienen las direciones de los límites entre !as diversas zonas de la memoria. No son variables de BASIC, por lo que sus nombres no serán identificados por el ordenador.</p>

<div align="center"><img src="images/pag165.png" border="0"></div>

<p>Los mapas de la unidad Microdrive sólo existen cuando se utiliza este dispositivo, por lo que, normalmente, sus posiciones están vacías.</p>

<p>La zona para información de los canales contiene la información pertinente sobre los dispositivos de entrada y salida, es decir, el teclado (con la mitad inferior de la pantalla), la mitad superior de la pantalla y la impresora.</p>

<p>Cada línea del programa BASIC tiene la forma:</p>

<div align="center"><img src="images/pag166_01.png" border="0"></div>

<p>Nótese que, a diferencia con todos los demás casos de números representados con 2 bytes, en el Z80, el número de línea se almacenará aquí con el byte más significativo en cabeza: es decir, en el mismo orden en que se escriben.</p>

<p>Cualquier constante numérica del programa va seguida de su forma binaria, empleando el carácter <b>CHR$ 14</b> seguido de 5 bytes para el propio número.</p>

<p>Las variables poseen formatos diferentes de acuerdo con sus distintas naturalezas. Las letras que componen los nombres deben ser imaginadas partiendo de las minúsculas:</p>

<div align="center"><img src="images/pag166_02.png" border="0"></div>

<p>Número cuyo nombre es más largo que una letra:</p>

<div align="center"><img src="images/pag167_01.png" border="0"></div>

<p>Matriz de números:</p>

<div align="center"><img src="images/pag167_02.png" border="0"></div>

<p>El orden de los elementos es:</p>

<p>primero, los elementos para los cuales el primer subíndice es 1, seguidamente, los elementos para los cuales el primer subíndice es 2</p>

<p>a continuación, los elementos para los cuales el primer subíndice es 3</p>

<p>y así sucesivamente para todos los valores posibles del primer subíndice.</p>

<p>Los elementos con un primer subíndice dado se ordenan en la misma manera, empleando el segundo subíndice y así sucesivamente hasta alcanzar el último.</p>

<p>Como ejemplo, los elementos de la matriz b de 3 * 6 del capítulo 13 se almacenan en orden b(1,1) b(1,2) b(1,3) b(1,4) b(1,5) b(1,6) b(2,1) b(2,2) ... b(2,6) b(3,1) b(3,2) ... b(3,6).</p>

<p>Variable de control para un bucle <b>FOR-NEXT</b>:</p>

<div align="center"><img src="images/pag167_03.png" border="0"></div>

<p>Cadenas</p>

<div align="center"><img src="images/pag168_01.png" border="0"></div>

<p>Matriz de caracteres:</p>

<div align="center"><img src="images/pag168_02.png" border="0"></div>

<p>El calculador es la parte del sistema BASIC que trata de la aritmética y los números con los que opera están contenidos en su mayoría en su pila de memoria.</p>

<p>La parte sobrante contiene el espacio no usado hasta ahora.</p>

<p>La pila de la máquina es la que usa el procesador del Z80 para contener las direcciones de retorno y elementos similares.</p>

<p>La pila para <b>GO SUB</b> se mencionó ya en el capítulo 5.</p>

<p>El byte hacia el que apunta <b>RAMTOP</b> tiene la dirección más alta que utiliza el sistema BASIC. Aún cuando <b>NEW</b> borra la RAM, lo hace sin alterar los gráficos definidos por el usuario. Se puede variar la dirección de <b>RAMTOP</b> poniendo un número en una sentencia <b>CLEAR</b>:</p>

<div align="center"><span class="codigo"><b>CLEAR</b> nueva <b>RAMTOP</b></span></div>

<p>Esta sentencia</p>

<ol start=1 type=i>

<li><p>borra todas las variables</p></li>
<li><p>borra el fichero de la representación visual (como <b>CLS</b>)</p></li>
<li><p>reajusta la posición de <b>PLOT</b> a la esquina inferior izquierda</p></li>
<li><p>ejecuta una restauración (<b>RESTORE</b>)</p></li>
<li><p>borra la pila de <b>GO SUB</b> y la coloca en el nuevo límite definido por <b>RAMTOP</b> (suponiendo que queda entre la pila de cálculo y el final físico de la RAM).</p>
<p>En cualquier otro caso, deja el límite del <b>RAMTOP</b> donde estaba.</p></li>

</ol>

<p><b>RUN</b> también produce borrado como <b>CLEAR</b>, aunque nunca altera el valor de la <b>RAMTOP</b>.</p>

<p>Utilizando de esta manera la instrucción <b>CLEAR</b> es posible tanto subir el límite <b>RAMTOP</b> de modo que se haga más sitio para el BASIC recubriendo los gráficos definidos por el usuario, como llevar el límite <b>RAMTOP</b> hacia abajo permitiendo más cantidad de RAM de la prevista en la instrucción <b>NEW</b>.</p>

<p>Teclee <b>NEW</b> y después <b>CLEAR 23800</b>, para hacerse una idea de lo que ocurre en la máquina cuando se llena.</p>

<p>Una de la primeras cosas que se notará cuando se comienza a escribir un programa es que el ordenador deja de aceptar entradas y hace sonar el zumbador. Esto significa que el ordenador está repleto y hay que vaciarlo ligeramente. Existen, además, dos mensajes de error cuyo significado es muy parecido: <b>4 Memory full</b> (Memoria completa) y <b>G No room for line</b> (No hay sitio para más líneas).</p>

<p>El zumbador suena también cuando se escribe una línea más larga de 23 líneas; sin embargo, el mensaje no se pierde, aunque no pueda verse (el zumbador suena como disuasión para escribir algo más).</p>

<p>Se puede ajustar la duración del zumbido mediante la instrucción <b>POKE</b> en la dirección 23608. La duración normal correspondiente al número 64 puede ser sustituida por otro número.</p>

<p>Cualquier número (a excepción del 0) puede escribirse únicamente como</p>

<div align="center"><span class="codigo">± m x 2e</span></div>

<p>donde <b>±</b> es el signo</p>

<p><b>m</b> es la mantisa y queda entre 1/2 y 1 (no puede ser 1), y <b>e</b> es el exponente, un número entero (posiblemente negativo).</p>

<p>Supóngase que <b>m</b> se escribe en la escala binaria. Ya que es una fracción, poseerá un punto binario (como la coma, o punto, decimal en la escala de diez) seguido de una fracción binaria (igual que una fracción decimal); así, en binario</p>

<p>un medio se escribe .1</p>

<p>un cuarto se escribe .01</p>

<p>tres cuartos se escriben .11</p>

<p>una décima se escribe .000110011001100110011 ... etc. Nuestro número <b>m</b>, es menor que la unidad, por lo que su representación binaria carece de cifras antes del punto (coma en español) decimal. Y como quiera que su menor valor es 1/2, el bit que sigue inmediatamente al punto (coma en español) decimal es siempre un 1.</p>

<p>Para almacenar un número en el ordenador, disponemos de 5 octetos (bytes), de la manera que sigue:</p>

<ol type=i start=1>

<li>se escriben los ocho primeros bits de la mantisa en el segundo octeto (sabemos que el primer bit es un 1), los segundos ocho bits en el tercer octeto, los terceros ocho bits en el cuarto octeto y los cuartos ocho bits en el quinto octeto.</li>

<li>se sustituye el primer bit del segundo octeto (que sabemos que es un 1) por el signo: 0 para más y 1 para menos.</li>

<li>se escribe el exponente +128 en el primer octeto. Por ejemplo, supongamos que nuestro número es 1 / 10<br>
<div align="center"><span class="codigo">1 / 10 = 4 / 5 x 2 - 3</span></div>
</li>

</ol>

<p>Entonces, la mantisa <b>m</b> es 11001100110011001100110011001100 en binario (como el bit 33° es un 1, redondearemos el bit 32° de 0 a 1) y el exponente <b>e</b> es -3. Aplicando las 3 reglas anteriores, encontramos los cinco octetos:</p>

<div align="center"><img src="images/pag170.png" border="0"></div>

<p>Existe un método alternativo para almacenar números enteros comprendidos entre -65535 y +65535:</p>

<ol start=1 type=i>

<li>el primer octeto es 0.</li>

<li>el segundo octeto es 0 para un número positivo y FFh para uno negativo.</li>

<li>los octetos tercero y cuarto son los octetos menos y más significativos, respectivamente, del número (o el número +131072 si es negativo).</li>

<li>El quinto octeto (byte) es cero.</li>

</ol>

<p><b>(1) Nota</b>: La letra <b>h</b> significa que está en hexadecimal.</p>

<div align="center"><a href="capitulo24.html#inicio">Subir</a></div>

</span>
</td>
</tr>
</table>
<html>
<head>
  <meta http-equiv="content-type"
 content="text/html; charset=ISO-8859-1">
  <meta name="author" content="Miguel">
  <script language="JavaScript">
<!--
function enlace(url)
{
document.location = url.options[url.selectedIndex].value;
}
-->
  </script>
</head>
<body>
<table cellpadding="2" bgcolor="d9dddd" cellspacing="0" border="0" width="700"
 align="center">
  <tbody>
    <tr>
      <td valign="middle" rowspan="1" colspan="1">
      <form>
        <select onchange="enlace(this)" name="select" target="main"
 title="Selecciona capítulo" align="center">
        <option value="" selected="selected">-Selecciona capítulo-</option>
        <option value="index.html">Indice</option>
        <option value="capitulo01.html">Capítulo 1</option>
        <option value="capitulo02.html">Capítulo 2</option>
	<option value="capitulo03.html">Capítulo 3</option>
	<option value="capitulo04.html">Capítulo 4</option>
	<option value="capitulo05.html">Capítulo 5</option>
	<option value="capitulo06.html">Capítulo 6</option>
	<option value="capitulo07.html">Capítulo 7</option>
	<option value="capitulo08.html">Capítulo 8</option>
	<option value="capitulo09.html">Capítulo 9</option>
	<option value="capitulo10.html">Capítulo 10</option>
	<option value="capitulo11.html">Capítulo 11</option>
	<option value="capitulo12.html">Capítulo 12</option>
        <option value="capitulo13.html">Capítulo 13</option>
	<option value="capitulo14.html">Capítulo 14</option>
	<option value="capitulo15.html">Capítulo 15</option>
	<option value="capitulo16.html">Capítulo 16</option>
	<option value="capitulo17.html">Capítulo 17</option>
	<option value="capitulo18.html">Capítulo 18</option>
	<option value="capitulo19.html">Capítulo 19</option>
	<option value="capitulo20.html">Capítulo 20</option>
	<option value="capitulo21.html">Capítulo 21</option>
	<option value="capitulo22.html">Capítulo 22</option>
	<option value="capitulo23.html">Capítulo 23</option>
	<option value="capitulo24.html">Capítulo 24</option>
	<option value="capitulo25.html">Capítulo 25</option>
	<option value="capitulo26.html">Capítulo 26</option>
	</select>
      </form>
      </td>
      <td valign="middle" width="74%" align="right">
      <h4><font color="#000000">Manual de Basic Spectrum 48k.</font></h4>
      </td>
    </tr>
  </tbody>
</table>
</body>
</html>
</body>
</html>
